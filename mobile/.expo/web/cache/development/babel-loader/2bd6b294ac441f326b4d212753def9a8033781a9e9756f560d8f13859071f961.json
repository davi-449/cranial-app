{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport api from \"../services/api\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AuthContext = createContext({});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    loading = _useState4[0],\n    setLoading = _useState4[1];\n  useEffect(function () {\n    function loadStorageData() {\n      return _loadStorageData.apply(this, arguments);\n    }\n    function _loadStorageData() {\n      _loadStorageData = _asyncToGenerator(function* () {\n        var _useState5 = useState({\n            id: 1,\n            username: 'teste',\n            email: 'teste@example.com',\n            role: 'admin'\n          }),\n          _useState6 = _slicedToArray(_useState5, 2),\n          user = _useState6[0],\n          setUser = _useState6[1];\n        var storedToken = yield AsyncStorage.getItem('@CranialApp:token');\n        var storedUser = yield AsyncStorage.getItem('@CranialApp:user');\n        if (storedUser && storedToken) {\n          api.defaults.headers.common.Authorization = \"Bearer \" + storedToken;\n          setUser(JSON.parse(storedUser));\n        }\n        setLoading(false);\n      });\n      return _loadStorageData.apply(this, arguments);\n    }\n    loadStorageData();\n  }, []);\n  function signIn(_x, _x2) {\n    return _signIn.apply(this, arguments);\n  }\n  function _signIn() {\n    _signIn = _asyncToGenerator(function* (username, password) {\n      try {\n        var response = yield api.post('/auth/login', {\n          username: username,\n          password: password\n        });\n        var _response$data = response.data,\n          token = _response$data.token,\n          userData = _response$data.user;\n        yield AsyncStorage.setItem('@CranialApp:user', JSON.stringify(userData));\n        yield AsyncStorage.setItem('@CranialApp:token', token);\n        api.defaults.headers.common.Authorization = \"Bearer \" + token;\n        setUser(userData);\n      } catch (error) {\n        throw new Error('Falha na autenticação. Verifique suas credenciais.');\n      }\n    });\n    return _signIn.apply(this, arguments);\n  }\n  function signOut() {\n    return _signOut.apply(this, arguments);\n  }\n  function _signOut() {\n    _signOut = _asyncToGenerator(function* () {\n      yield AsyncStorage.removeItem('@CranialApp:user');\n      yield AsyncStorage.removeItem('@CranialApp:token');\n      setUser(null);\n    });\n    return _signOut.apply(this, arguments);\n  }\n  return _jsx(AuthContext.Provider, {\n    value: {\n      signed: !!user,\n      user: user,\n      loading: loading,\n      signIn: signIn,\n      signOut: signOut\n    },\n    children: children\n  });\n};\nexport function useAuth() {\n  var context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n}","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","AsyncStorage","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","loading","setLoading","loadStorageData","_loadStorageData","apply","arguments","_asyncToGenerator","_useState5","id","username","email","role","_useState6","storedToken","getItem","storedUser","defaults","headers","common","Authorization","JSON","parse","signIn","_x","_x2","_signIn","password","response","post","_response$data","data","token","userData","setItem","stringify","error","Error","signOut","_signOut","removeItem","Provider","value","signed","useAuth","context"],"sources":["C:/Users/Davi/Desktop/projetos/cranial-app/cranial-app/mobile/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport api from '../services/api';\n\ninterface User {\n  id: number;\n  username: string;\n  email: string;\n  role: string;\n}\n\ninterface AuthContextData {\n  signed: boolean;\n  user: User | null;\n  loading: boolean;\n  signIn(username: string, password: string): Promise<void>;\n  signOut(): void;\n}\n\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData);\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    async function loadStorageData() {\n      // Modifique o useState inicializando o usuário com dados fictícios\n      const [user, setUser] = useState<User | null>({\n        id: 1,\n        username: 'teste',\n        email: 'teste@example.com',\n        role: 'admin'\n      });\n      const storedToken = await AsyncStorage.getItem('@CranialApp:token');\n      const storedUser = await AsyncStorage.getItem('@CranialApp:user');\n\n      if (storedUser && storedToken) {\n        api.defaults.headers.common.Authorization = `Bearer ${storedToken}`;\n        setUser(JSON.parse(storedUser));\n      }\n\n      setLoading(false);\n    }\n\n    loadStorageData();\n  }, []);\n\n  async function signIn(username: string, password: string) {\n    try {\n      const response = await api.post('/auth/login', {\n        username,\n        password,\n      });\n\n      const { token, user: userData } = response.data;\n\n      await AsyncStorage.setItem('@CranialApp:user', JSON.stringify(userData));\n      await AsyncStorage.setItem('@CranialApp:token', token);\n\n      api.defaults.headers.common.Authorization = `Bearer ${token}`;\n\n      setUser(userData);\n    } catch (error) {\n      throw new Error('Falha na autenticação. Verifique suas credenciais.');\n    }\n  }\n\n  async function signOut() {\n    await AsyncStorage.removeItem('@CranialApp:user');\n    await AsyncStorage.removeItem('@CranialApp:token');\n    setUser(null);\n  }\n\n  return (\n    <AuthContext.Provider value={{ signed: !!user, user, loading, signIn, signOut }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n\n  return context;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}